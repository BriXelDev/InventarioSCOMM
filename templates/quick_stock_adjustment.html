<!-- 
=============================================================================
QUICK_STOCK_ADJUSTMENT.HTML - AJUSTE RÃPIDO DE INVENTARIO
=============================================================================

PROPÃ“SITO:
Template especializado para realizar ajustes rÃ¡pidos de stock de productos
especÃ­ficos. Permite incrementar o decrementar inventario con trazabilidad
completa y validaciones de negocio.

CARACTERÃSTICAS PRINCIPALES:
- Formulario especÃ­fico para ajustes de stock
- ValidaciÃ³n frontend con JavaScript personalizado
- InformaciÃ³n contextual del producto seleccionado
- Tipos de ajuste diferenciados (entrada/salida)
- IntegraciÃ³n con sistema de movimientos de inventario
- PrevenciÃ³n de stock negativo

PATRONES JINJA2 IMPLEMENTADOS:
- Template inheritance con layout base
- Filtros de datos (|int para conversiones)
- Atributos HTML dinÃ¡micos (data-*)
- Valores por defecto con operador OR
- URL generation para navegaciÃ³n y recursos

VALIDACIONES Y CONTROLES:
- HTML5 validation (required, min, type=number)
- JavaScript para cÃ¡lculos en tiempo real
- PrevenciÃ³n de operaciones que generen stock negativo
- Motivos obligatorios para trazabilidad
=============================================================================
-->

{% extends "layout.html" %}
<!-- 
HERENCIA DE LAYOUT BASE:
Aprovecha toda la infraestructura del sistema:
- NavegaciÃ³n con control de acceso por roles
- Sistema de mensajes flash para feedback
- CSS base y estructura responsive
- JavaScript compartido y manejo de sesiones
-->

{% block title %}Ajuste de Stock - Sistema de Inventario{% endblock %}
<!-- 
TÃTULO ESPECÃFICO DE FUNCIONALIDAD:
Identifica claramente la acciÃ³n que se estÃ¡ realizando.
Ãštil para navegaciÃ³n y bookmarks del usuario.
-->

{% block head %}
    <!-- 
    CSS ESPECÃFICO PARA AJUSTES DE STOCK:
    Estilos dedicados para:
    - Formulario de ajuste centrado y destacado
    - InformaciÃ³n del producto con diseÃ±o card
    - Botones diferenciados por tipo de acciÃ³n
    - Estados visuales para feedback en tiempo real
    - Responsive design para dispositivos mÃ³viles
    -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/quick_stock_adjustment.css') }}">
{% endblock %}

{% block content %}
<!-- CONTENIDO PRINCIPAL DEL AJUSTE DE STOCK -->

<div class="stock-adjustment-container">
    <!-- 
    CONTENEDOR PRINCIPAL:
    Wrapper para toda la funcionalidad de ajuste.
    Permite estilos especÃ­ficos y centrado del contenido.
    -->
    
    <h2 class="stock-adjustment-title">ðŸ”§ Ajuste RÃ¡pido de Stock</h2>
    <!-- 
    TÃTULO CON ICONO:
    - Emoji de herramienta (ðŸ”§) refuerza visualmente la funciÃ³n de ajuste
    - Clase especÃ­fica para tipografÃ­a y espaciado
    - "RÃ¡pido" indica que es una operaciÃ³n Ã¡gil, no un proceso complejo
    -->
    
    <div class="product-info" data-current-stock="{{ product['quantity']|int }}">
    <!-- 
    INFORMACIÃ“N DEL PRODUCTO CON DATA ATTRIBUTE:
    
    DATA-CURRENT-STOCK:
    Atributo HTML personalizado que almacena el stock actual.
    JavaScript puede leer este valor para validaciones en tiempo real.
    
    FILTRO |int:
    Convierte el valor a entero para evitar problemas con decimales.
    Asegura que JavaScript reciba un nÃºmero vÃ¡lido.
    
    EJEMPLO:
    Si product['quantity'] = "25.0" â†’ data-current-stock="25"
    -->
        <h3>Producto: {{ product['name'] }}</h3>
        <!-- 
        NOMBRE DEL PRODUCTO:
        IdentificaciÃ³n clara del item que se estÃ¡ ajustando.
        -->
        
        <p><strong>Stock actual:</strong> <span class="current-stock">{{ product['quantity'] }} unidades</span></p>
        <!-- 
        STOCK ACTUAL DESTACADO:
        - <strong> para label descriptivo
        - <span> con clase especÃ­fica para el valor numÃ©rico
        - Permite que JavaScript actualice el valor dinÃ¡micamente
        - "unidades" clarifica la mÃ©trica utilizada
        -->
        
        <p><strong>CategorÃ­a:</strong> {{ product['category'] or 'Sin categorÃ­a' }}</p>
        <!-- 
        CATEGORÃA CON VALOR POR DEFECTO:
        
        OPERADOR OR:
        Si product['category'] es None, vacÃ­o, o False, usa 'Sin categorÃ­a'.
        Previene mostrar valores None/null al usuario.
        
        CASOS DE USO:
        - product['category'] = "ElectrÃ³nicos" â†’ "ElectrÃ³nicos"
        - product['category'] = None â†’ "Sin categorÃ­a"
        - product['category'] = "" â†’ "Sin categorÃ­a"
        -->
        
        <p><strong>Proveedor:</strong> {{ product['provider'] or 'Sin proveedor' }}</p>
        <!-- 
        PROVEEDOR CON FALLBACK SIMILAR:
        Mismo patrÃ³n que categorÃ­a para datos opcionales.
        Mejora la experiencia mostrando texto descriptivo vs valores nulos.
        -->
    </div>
    
    <!-- FORMULARIO DE AJUSTE -->
    <div class="adjustment-form-container">
        <!-- 
        CONTENEDOR DEL FORMULARIO:
        Wrapper especÃ­fico para estilos del form de ajuste.
        -->
        
        <form method="POST" class="adjustment-form">
        <!-- 
        FORMULARIO POST PARA AJUSTE:
        
        METHOD="POST":
        OperaciÃ³n de modificaciÃ³n de datos requiere POST por seguridad.
        
        ACTION IMPLÃCITA:
        No especifica action, envÃ­a al mismo endpoint que muestra la pÃ¡gina.
        Flask maneja GET (mostrar form) y POST (procesar ajuste).
        -->
            <div class="form-group">
                <label for="adjustment_type">Tipo de Ajuste:</label>
                <select id="adjustment_type" name="adjustment_type" required>
                    <option value="">Seleccionar tipo...</option>
                    <!-- 
                    OPCIÃ“N VACÃA INICIAL:
                    Fuerza al usuario a seleccionar explÃ­citamente el tipo.
                    Previene ajustes accidentales por valor por defecto.
                    -->
                    <option value="add">âž• Agregar Stock (Entrada)</option>
                    <option value="subtract">âž– Reducir Stock (Salida)</option>
                    <!-- 
                    OPCIONES CON ICONOS DESCRIPTIVOS:
                    
                    VALUE="add":
                    - Procesado en Flask como incremento de stock
                    - Icono âž• refuerza visualmente la acciÃ³n
                    - Texto descriptivo incluye tipo de movimiento
                    
                    VALUE="subtract":
                    - Procesado como decremento de stock
                    - Icono âž– indica reducciÃ³n
                    - JavaScript validarÃ¡ que no genere stock negativo
                    -->
                </select>
                <!-- 
                SELECT REQUERIDO:
                HTML5 validation obliga a seleccionar una opciÃ³n vÃ¡lida.
                -->
            </div>
            
            <div class="form-group">
                <label for="quantity">Cantidad:</label>
                <input type="number" id="quantity" name="quantity" min="1" required>
                <!-- 
                INPUT NUMÃ‰RICO CON VALIDACIONES:
                
                TYPE="number":
                - Teclado numÃ©rico en mÃ³viles
                - Spinners para incrementar/decrementar
                - ValidaciÃ³n automÃ¡tica de formato numÃ©rico
                
                MIN="1":
                - Previene cantidades cero o negativas
                - HTML5 validation automÃ¡tica
                - JavaScript puede acceder a esta restricciÃ³n
                
                REQUIRED:
                - Campo obligatorio para procesar ajuste
                - Sin cantidad no se puede realizar operaciÃ³n
                -->
            </div>
            
            <div class="form-group">
                <label for="reason">Motivo del Ajuste:</label>
                <input type="text" id="reason" name="reason" placeholder="Ej: RecepciÃ³n de mercancÃ­a, DevoluciÃ³n, PÃ©rdida, etc." required>
                <!-- 
                MOTIVO OBLIGATORIO PARA TRAZABILIDAD:
                
                TYPE="text":
                Campo de texto libre para descripciÃ³n del motivo.
                
                PLACEHOLDER EDUCATIVO:
                Ejemplos concretos guÃ­an al usuario sobre quÃ© escribir.
                
                REQUIRED:
                AuditorÃ­a y trazabilidad requieren motivo documentado.
                Cada movimiento debe tener justificaciÃ³n.
                
                CASOS DE USO COMUNES:
                - "RecepciÃ³n de mercancÃ­a del proveedor X"
                - "DevoluciÃ³n de cliente por defecto"
                - "Inventario fÃ­sico - diferencia encontrada"
                - "Producto daÃ±ado - baja por calidad"
                -->
            </div>
            
            <!-- BOTONES DE ACCIÃ“N -->
            <div class="form-actions">
                <button type="submit" class="btn btn-success adjustment-btn">Realizar Ajuste</button>
                <!-- 
                BOTÃ“N PRINCIPAL DE ENVÃO:
                
                TYPE="submit":
                EnvÃ­a el formulario completo al backend.
                
                CLASES CSS:
                - btn: Estilo base de botÃ³n del sistema
                - btn-success: Color verde para acciÃ³n positiva
                - adjustment-btn: Estilos especÃ­ficos de ajuste
                
                TEXTO DESCRIPTIVO:
                "Realizar Ajuste" claramente indica la acciÃ³n final.
                -->
                
                <a href="{{ url_for('home') }}" class="btn cancel-btn">Cancelar</a>
                <!-- 
                BOTÃ“N DE CANCELACIÃ“N:
                
                ENLACE VS BOTÃ“N:
                <a> en lugar de <button> porque navega, no envÃ­a formulario.
                
                URL_FOR('home'):
                Regresa al listado principal de productos.
                NavegaciÃ³n lÃ³gica despuÃ©s de cancelar operaciÃ³n.
                
                CLASE cancel-btn:
                Estilo tÃ­picamente gris o neutro para acciones secundarias.
                -->
            </div>
        </form>
    </div>
    
    <!-- INFORMACIÃ“N EDUCATIVA -->
    <div class="info-section">
        <h4>ðŸ’¡ InformaciÃ³n:</h4>
        <!-- 
        SECCIÃ“N INFORMATIVA CON ICONO:
        Icono de bombilla (ðŸ’¡) indica tips o informaciÃ³n Ãºtil.
        -->
        <ul>
            <li><strong>Entrada:</strong> Agrega la cantidad especificada al stock actual</li>
            <!-- 
            EXPLICACIÃ“N DE ENTRADA:
            Clarifica que "add" incrementa el stock existente.
            Previene confusiÃ³n sobre si reemplaza o suma.
            -->
            <li><strong>Salida:</strong> Reduce la cantidad del stock actual (no puede ser negativo)</li>
            <!-- 
            EXPLICACIÃ“N DE SALIDA CON RESTRICCIÃ“N:
            - Clarifica que "subtract" reduce stock
            - Importante: menciona restricciÃ³n de stock negativo
            - Usuario entiende limitaciones antes de intentar operaciÃ³n
            -->
            <li>Todos los ajustes quedan registrados en el historial de movimientos</li>
            <!-- 
            INFORMACIÃ“N DE TRAZABILIDAD:
            Asegura al usuario que hay auditorÃ­a completa.
            Importante para control interno y responsabilidad.
            -->
        </ul>
    </div>
</div>
<!-- JAVASCRIPT ESPECÃFICO PARA AJUSTES -->
{% block scripts %}
    <!-- 
    SCRIPT ESPECÃFICO PARA FUNCIONALIDAD DE AJUSTE:
    
    ARCHIVO DEDICADO:
    quick_stock_adjustment.js contiene lÃ³gica especÃ­fica como:
    - ValidaciÃ³n en tiempo real de stock negativo
    - CÃ¡lculo de stock resultante al cambiar valores
    - Feedback visual durante la ediciÃ³n
    - PrevenciÃ³n de envÃ­o si validaciones fallan
    
    INTEGRACIÃ“N CON DATA ATTRIBUTES:
    JavaScript lee data-current-stock del HTML para validaciones.
    
    FUNCIONALIDADES TÃPICAS:
    - Mostrar stock resultante antes de enviar
    - Prevenir subtract que genere valores negativos
    - Resaltar campos con errores de validaciÃ³n
    - Confirmar operaciones de gran impacto
    -->
    <script src="{{ url_for('static', filename='js/quick_stock_adjustment.js') }}"></script>
{% endblock %}
{% endblock %}

<!-- 
=============================================================================
RESUMEN TÃ‰CNICO - QUICK_STOCK_ADJUSTMENT.HTML:
=============================================================================

PROPÃ“SITO:
Template especializado para realizar ajustes rÃ¡pidos y seguros de inventario
en productos especÃ­ficos. Implementa una interfaz intuitiva con validaciones
robustas para operaciones crÃ­ticas de stock.

CARACTERÃSTICAS IMPLEMENTADAS:

1. INTERFAZ DE AJUSTE ESPECÃFICO:
   - InformaciÃ³n contextual del producto seleccionado
   - Formulario dedicado con validaciones HTML5
   - Tipos de ajuste claramente diferenciados (entrada/salida)
   - Botones de acciÃ³n con estilos diferenciados

2. VALIDACIONES MULTINIVEL:
   - HTML5 validation (required, min, type=number)
   - JavaScript en tiempo real para stock negativo
   - Data attributes para integraciÃ³n frontend-backend
   - Motivos obligatorios para trazabilidad completa

3. EXPERIENCIA DE USUARIO OPTIMIZADA:
   - InformaciÃ³n del producto siempre visible
   - Iconos descriptivos para tipos de ajuste
   - Placeholders educativos con ejemplos
   - SecciÃ³n informativa con reglas del negocio

4. INTEGRACIÃ“N CON SISTEMA DE INVENTARIO:
   - Trazabilidad completa en historial de movimientos
   - PreservaciÃ³n de contexto del producto
   - NavegaciÃ³n coherente con cancelaciÃ³n
   - Feedback a travÃ©s de mensajes flash

5. DATOS DINÃMICOS Y FALLBACKS:
   - Filtro |int para conversiÃ³n segura de tipos
   - Operador OR para valores por defecto
   - Data attributes para JavaScript
   - InformaciÃ³n contextual completa del producto

PATRONES JINJA2 AVANZADOS UTILIZADOS:

- FILTROS DE CONVERSIÃ“N:
  {{ product['quantity']|int }} (conversiÃ³n segura a entero)

- VALORES POR DEFECTO:
  {{ product['category'] or 'Sin categorÃ­a' }} (fallback para nulos)

- DATA ATTRIBUTES DINÃMICOS:
  data-current-stock="{{ product['quantity']|int }}" (integraciÃ³n JS)

- TEMPLATE INHERITANCE:
  {% extends "layout.html" %} con blocks especÃ­ficos

- URL GENERATION:
  {{ url_for('home') }} para navegaciÃ³n coherente

FLUJO DE OPERACIÃ“N:

1. ACCESO A AJUSTE:
   - Usuario selecciona producto desde listado principal
   - Sistema carga template con informaciÃ³n del producto
   - Formulario se inicializa vacÃ­o pero con contexto

2. CONFIGURACIÃ“N DE AJUSTE:
   - Usuario selecciona tipo (entrada/salida)
   - Ingresa cantidad numÃ©rica (min=1)
   - Proporciona motivo descriptivo obligatorio
   - JavaScript valida en tiempo real

3. VALIDACIÃ“N Y ENVÃO:
   - HTML5 valida campos requeridos y formatos
   - JavaScript previene stock negativo en sustracciones
   - POST request envÃ­a datos al backend
   - Flask procesa y actualiza inventario

4. RESULTADO Y NAVEGACIÃ“N:
   - Flash message confirma Ã©xito o informa errores
   - Usuario puede continuar con mÃ¡s ajustes
   - CancelaciÃ³n regresa al listado principal
   - Historial de movimientos registra operaciÃ³n

VALIDACIONES DE NEGOCIO:

- PREVENCIÃ“N DE STOCK NEGATIVO:
  JavaScript + backend verifican que sustracciones no generen valores < 0

- CANTIDADES POSITIVAS:
  HTML5 min="1" + type="number" aseguran valores vÃ¡lidos

- MOTIVOS OBLIGATORIOS:
  Required attribute garantiza trazabilidad completa

- TIPOS DE AJUSTE EXPLÃCITOS:
  Select con opciÃ³n vacÃ­a fuerza selecciÃ³n consciente

CONSIDERACIONES DE SEGURIDAD:
- ValidaciÃ³n dual (frontend + backend) para operaciones crÃ­ticas
- Motivos obligatorios para auditorÃ­a y responsabilidad
- PrevenciÃ³n de valores negativos accidentales
- Trazabilidad completa de todas las operaciones

CASOS DE USO PRINCIPALES:
- RecepciÃ³n de mercancÃ­a de proveedores
- Ajustes por inventarios fÃ­sicos
- CorrecciÃ³n de errores de captura
- Bajas por productos daÃ±ados o vencidos
- Devoluciones de clientes

DEPENDENCIAS TÃ‰CNICAS:
- layout.html para estructura base
- quick_stock_adjustment.css para estilos especÃ­ficos
- quick_stock_adjustment.js para validaciones dinÃ¡micas
- Sistema de productos Flask con stock tracking
- Historial de movimientos para auditorÃ­a

EXTENSIBILIDAD:
- FÃ¡cil agregar nuevos tipos de ajuste
- Campos adicionales para mÃ¡s contexto
- Validaciones personalizadas por tipo de producto
- IntegraciÃ³n con cÃ³digos de barras
- Workflows de aprobaciÃ³n para ajustes grandes
=============================================================================
-->
